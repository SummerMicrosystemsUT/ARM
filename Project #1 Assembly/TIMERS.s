#include <ST/iostm32f207zx.h>

	NAME TIMERS
	        
	PUBLIC TIMER_2_INIT
	PUBLIC TIMER_2_GENERATE_UPDATE_EVENT
	PUBLIC LOAD_TIMER_2_COUNTER_INTO_R12
	
        SECTION .TIMERS : CODE (2)
        THUMB
	
TIMER_2_INIT
	
	PUSH	{R0, R1}
	
	;ENABLE TIMER 2
	LDR	R0, =RCC_APB1ENR
	LDR	R1, [R0]
	ORR	R1, R1, #(1<<0)
	STR	R1, [R0]
	
	;TURN ON TIMER 2 COUNTER
	LDR	R0, =TIM2_CR1
	LDR	R1, [R0]
	ORR	R1, R1, #(1<<0)
	STR	R1, [R0]
		
	;SET TIMER 2 COUNTS 4 TIMES PER SECOND
	LDR	R0, =TIM2_PSC
	LDR	R1, [R0]
	ORR	R1, R1, #0x3D0900
	STR	R1, [R0]
	
	POP	{R0, R1}
	
	BX LR

TIMER_2_GENERATE_UPDATE_EVENT

	PUSH	{R0, R1}

	;GENERATE UPDATE EVENT
	LDR	R0, =TIM2_EGR
	LDR	R1, [R0]
	ORR	R1, R1, #(1<<0)
	STR	R1, [R0]
	
	POP	{R0, R1}
	
	BX LR
	
LOAD_TIMER_2_COUNTER_INTO_R12
	
	PUSH 	{R0}
	
	LDR	R0, =TIM2_CNT
	LDR	R12, [R0]
	
	POP	{R0}
	
	BX LR
	
	END