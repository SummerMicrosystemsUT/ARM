#include <ST/iostm32f207zx.h>

	NAME TIMERS
	        
	PUBLIC TIMER_2_INIT
	PUBLIC TIMER_2_GENERATE_UPDATE_EVENT
        
        SECTION .TIMERS : CODE (2)
        THUMB
	
TIMER_2_INIT
	;ENABLE TIMER 2
	LDR	R0, =RCC_APB1ENR
	LDR	R1, [R0]
	ORR	R1, R1, #(1<<0)
	STR	R1, [R0]
	
	;TURN ON TIMER 2 COUNTER
	LDR	R0, =TIM2_CR1
	LDR	R1, [R0]
	ORR	R1, R1, #(1<<0)
	STR	R1, [R0]
		
	;TURN ON ARR
	LDR	R0, =TIM2_CR1
	LDR	R1, [R0]
	ORR	R1, R1, #(1<<7)
	STR	R1, [R0]
	
	;SET AUTO RELOAD REGISTER
	LDR	R0, =TIM2_ARR
	LDR	R1, [R0]
	MOV	R1, #0x000009C4
	STR	R1, [R0]
	
	;SET TIMER 2 COUNTS 1000 TIMES PER SECOND
	LDR	R0, =TIM2_PSC
	LDR	R1, [R0]
	ORR	R1, R1, #0x3E80
	STR	R1, [R0]
	
	BX LR

TIMER_2_GENERATE_UPDATE_EVENT

	;GENERATE UPDATE EVENT
	LDR	R0, =TIM2_EGR
	LDR	R1, [R0]
	ORR	R1, R1, #(1<<0)
	STR	R1, [R0]
	
	BX LR
	
	END